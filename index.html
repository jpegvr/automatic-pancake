<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tower Duel Royale</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
<style>
body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background-color:#1F2937; color:white; overflow-x:hidden;}
.font-bangers { font-family: 'Bangers', cursive; }
.card { cursor:pointer; transition: transform .2s; }
.card.selected { transform:translateY(-10px) scale(1.05); box-shadow:0 0 10px #fff; }
.card.disabled { filter:grayscale(100%); cursor:not-allowed; }
.hidden { display:none; }
#game-board { background:#4CAF50; position:relative; width:100%; max-width:800px; height:600px; margin:auto; border:4px solid #8B4513; border-radius:12px; overflow:hidden; touch-action:none; }
.river { position:absolute; width:100%; height:10%; top:45%; background:linear-gradient(to right,#4682B4,#87CEEB); }
.troop { position:absolute; width:40px; height:40px; background:#f59e0b; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px; text-align:center; cursor:pointer; }
.enemy { background:red; }
.tower { position:absolute; width:60px; height:60px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:14px; text-align:center; color:white; }
.king { background:purple; }
.princess { background:blue; }
#card-hand { display:flex; gap:8px; overflow-x:auto; margin-top:8px; }
#card-collection { display:flex; flex-wrap:wrap; gap:6px; max-height:300px; overflow-y:auto; }
#current-deck { display:flex; flex-wrap:wrap; gap:6px; min-height:100px; }
.deck-tab.active { background:#6B21A8 !important; }
</style>
</head>
<body>

<!-- TITLE SCREEN -->
<div id="title-screen" class="flex flex-col items-center justify-center min-h-screen">
  <h1 class="text-6xl font-bangers text-yellow-400 mb-6">TOWER DUEL</h1>
  <button id="start-button" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg text-2xl mb-4">Quick Start</button>
  <button id="deck-button" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg text-2xl">Deck Builder</button>
</div>

<!-- GAME SCREEN -->
<div id="game-container" class="hidden flex flex-col items-center w-full p-4">
  <div id="game-board">
    <div class="river"></div>
  </div>
  <div class="w-full max-w-lg mt-4">
    <div class="flex justify-between mb-2">
      <span>Player Towers: <span id="player-towers">3</span></span>
      <span>AI Towers: <span id="ai-towers">3</span></span>
      <span>Time: <span id="timer">180</span>s</span>
    </div>
    <div id="card-hand"></div>
    <div class="flex items-center mt-2">
      <div class="w-full bg-gray-600 rounded-full h-6 mr-2 border-2 border-purple-400">
        <div id="elixir-bar-fill" class="bg-purple-600 h-full rounded-full" style="width:30%"></div>
      </div>
      <span id="elixir-count">3</span> / 10
    </div>
  </div>
</div>

<!-- DECK BUILDER -->
<div id="deck-builder-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex flex-col items-center justify-center p-4">
  <div class="bg-gray-700 p-6 rounded-lg w-full max-w-3xl border-4 border-yellow-400">
    <h2 class="text-3xl font-bangers text-yellow-400 mb-4 text-center">Build Your Deck</h2>
    <div class="flex justify-center mb-4">
      <button class="deck-tab active bg-gray-500 hover:bg-gray-600 px-4 py-2 rounded mr-2" data-deck="0">Deck 1</button>
      <button class="deck-tab bg-gray-500 hover:bg-gray-600 px-4 py-2 rounded mr-2" data-deck="1">Deck 2</button>
      <button class="deck-tab bg-gray-500 hover:bg-gray-600 px-4 py-2 rounded" data-deck="2">Deck 3</button>
    </div>
    <h3 class="mb-2">Your Deck (<span id="deck-count">0</span>/8)</h3>
    <div id="current-deck"></div>
    <h3 class="mt-4 mb-2">Card Collection</h3>
    <div id="card-collection"></div>
    <button id="start-battle-button" class="mt-6 w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg text-xl disabled:bg-gray-500 disabled:cursor-not-allowed">Start Battle</button>
  </div>
</div>

<!-- MESSAGE MODAL -->
<div id="message-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
  <div class="bg-gray-700 p-8 rounded-lg shadow-2xl text-center border-4 border-yellow-400">
    <h2 id="message-title" class="text-4xl font-bangers text-yellow-400 mb-4"></h2>
    <p id="message-text" class="mb-6 text-lg"></p>
    <button id="restart-button" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg text-xl">Play Again</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded',()=>{
  const titleScreen=document.getElementById('title-screen');
  const startButton=document.getElementById('start-button');
  const deckButton=document.getElementById('deck-button');
  const gameContainer=document.getElementById('game-container');
  const deckBuilderModal=document.getElementById('deck-builder-modal');
  const startBattleButton=document.getElementById('start-battle-button');
  const deckTabs=document.querySelectorAll('.deck-tab');
  const currentDeckEl=document.getElementById('current-deck');
  const cardCollectionEl=document.getElementById('card-collection');
  const deckCountEl=document.getElementById('deck-count');
  const cardHandEl=document.getElementById('card-hand');
  const elixirCountEl=document.getElementById('elixir-count');
  const elixirBarFill=document.getElementById('elixir-bar-fill');
  const messageModal=document.getElementById('message-modal');
  const restartButton=document.getElementById('restart-button');
  const messageTitle=document.getElementById('message-title');
  const messageText=document.getElementById('message-text');
  const aiTowersEl=document.getElementById('ai-towers');
  const playerTowersEl=document.getElementById('player-towers');
  const timerEl=document.getElementById('timer');
  const gameBoard=document.getElementById('game-board');

  let currentDeck=0;
  const decks=[[],[],[]];
  const allCards=[];
  const handSize=4;
  let playerElixir=3;
  const maxElixir=10;
  let timer=180;
  let timerInterval=null;
  let troops=[];
  let aiTowers=3, playerTowers=3;
  const towers=[];

  const troopNames=["Knight","Archer","Giant","Goblin","Wizard","Skeleton","Minion","Balloon","Hog Rider","Valkyrie","P.E.K.K.A","Musketeer","Baby Dragon","Electro Wizard","Ice Spirit","Fire Spirit","Mega Minion","Royal Ghost","Prince","Dark Prince","Ram Rider"];
  troopNames.forEach(n=>allCards.push({name:n,type:"Troop",cost:Math.floor(Math.random()*6)+1,damage:1,hp:5}));

  function renderDeck(){
    currentDeckEl.innerHTML='';
    decks[currentDeck].forEach((card,i)=>{
      const c=document.createElement('div');
      c.className='card bg-gray-500 p-2 rounded text-sm text-center';
      c.textContent=`${card.name} (${card.cost})`;
      c.addEventListener('click',()=>{decks[currentDeck].splice(i,1); renderDeck(); renderCardCollection();});
      currentDeckEl.appendChild(c);
    });
    deckCountEl.textContent=decks[currentDeck].length;
    startBattleButton.disabled=decks[currentDeck].length<4;
  }

  function renderCardCollection(){
    cardCollectionEl.innerHTML='';
    allCards.forEach(card=>{
      const c=document.createElement('div');
      c.className='card bg-gray-700 p-2 rounded text-sm text-center';
      c.textContent=`${card.name} (${card.cost})`;
      if(decks[currentDeck].includes(card)) c.classList.add('disabled');
      else c.addEventListener('click',()=>{
        if(decks[currentDeck].length>=8) return;
        decks[currentDeck].push(card);
        renderDeck(); renderCardCollection();
      });
      cardCollectionEl.appendChild(c);
    });
  }

  startButton.addEventListener('click',()=>{
    titleScreen.classList.add('hidden');
    if(decks[0].length<4){ deckBuilderModal.classList.remove('hidden'); renderDeck(); renderCardCollection();}
    else startGame();
  });

  deckButton.addEventListener('click',()=>{
    titleScreen.classList.add('hidden');
    deckBuilderModal.classList.remove('hidden');
    renderDeck(); renderCardCollection();
  });

  startBattleButton.addEventListener('click',()=>{
    deckBuilderModal.classList.add('hidden');
    startGame();
  });

  deckTabs.forEach(tab=>{
    tab.addEventListener('click',()=>{
      deckTabs.forEach(t=>t.classList.remove('active'));
      tab.classList.add('active');
      currentDeck=parseInt(tab.dataset.deck);
      renderDeck(); renderCardCollection();
    });
  });

  function startGame(){
    gameContainer.classList.remove('hidden');
    playerElixir=3; elixirCountEl.textContent=playerElixir;
    elixirBarFill.style.width=(playerElixir/maxElixir*100)+'%';
    timer=180; timerEl.textContent=timer;
    aiTowers=3; playerTowers=3; aiTowersEl.textContent=aiTowers; playerTowersEl.textContent=playerTowers;
    cardHandEl.innerHTML='';
    troops=[];
    towers.forEach(t=>t.el.remove()); towers.length=0;
    setupTowers();

    for(let i=0;i<handSize;i++) if(decks[currentDeck][i]) drawCard(decks[currentDeck][i]);

    if(timerInterval) clearInterval(timerInterval);
    timerInterval=setInterval(()=>{
      timer--; timerEl.textContent=timer;
      moveTroops();
      checkVictory();
      if(timer<=0) endGame("Draw","Time ran out!");
    },1000);
  }

  function setupTowers(){
    // Player towers
    spawnTower(50,500,'king','player');
    spawnTower(150,500,'princess','player');
    spawnTower(650,500,'princess','player');
    // AI towers
    spawnTower(50,50,'princess','ai');
    spawnTower(650,50,'princess','ai');
    spawnTower(350,50,'king','ai');
  }

  function spawnTower(x,y,type,owner){
    const t=document.createElement('div');
    t.className='tower '+type;
    t.textContent=type[0].toUpperCase();
    gameBoard.appendChild(t);
    t.style.left=x+'px'; t.style.top=y+'px';
    towers.push({el:t,type,owner,hp:10});
  }

  function drawCard(card){
    const c=document.createElement('div');
    c.className='card bg-purple-500 p-2 rounded text-sm text-center';
    c.textContent=`${card.name} (${card.cost})`;
    if(playerElixir<card.cost) c.classList.add('disabled');
    let dragging=false;
    let offsetX, offsetY;

    c.addEventListener('mousedown', e=>{
      if(playerElixir>=card.cost){
        dragging=true;
        offsetX=e.offsetX; offsetY=e.offsetY;
      }
    });
    document.addEventListener('mousemove', e=>{
      if(dragging){
        c.style.position='absolute';
        c.style.zIndex='999';
        c.style.left=(e.pageX-offsetX)+'px';
        c.style.top=(e.pageY-offsetY)+'px';
      }
    });
    document.addEventListener('mouseup', e=>{
      if(dragging){
        dragging=false;
        const rect=gameBoard.getBoundingClientRect();
        if(e.pageX>=rect.left && e.pageX<=rect.right && e.pageY>=rect.top+rect.height/2 && e.pageY<=rect.bottom){
          // Spawn troop
          playerElixir-=card.cost;
          elixirCountEl.textContent=playerElixir;
          elixirBarFill.style.width=(playerElixir/maxElixir*100)+'%';
          spawnTroop(card,"player",e.pageX-rect.left-20,e.pageY-rect.top-20);
        }
        c.style.position=''; c.style.zIndex=''; c.style.left=''; c.style.top='';
      }
    });

    cardHandEl.appendChild(c);
  }

  function spawnTroop(card,owner,x,y){
    const t=document.createElement('div');
    t.className='troop'; if(owner==="ai") t.classList.add('enemy');
    t.textContent=card.name[0];
    gameBoard.appendChild(t);
    x=x||50; y=y||500;
    t.style.left=x+'px'; t.style.top=y+'px';
    troops.push({el:t,owner,damage:card.damage,hp:card.hp});
  }

  function moveTroops(){
    troops.forEach(tr=>{
      let targetTower=null;
      let dist=Infinity;
      towers.filter(tt=>tt.owner!==tr.owner).forEach(tt=>{
        const dx=tt.el.offsetLeft-tr.el.offsetLeft;
        const dy=tt.el.offsetTop-tr.el.offsetTop;
        const d=Math.sqrt(dx*dx+dy*dy);
        if(d<dist){dist=d; targetTower=tt;}
      });
      if(targetTower){
        const dx=targetTower.el.offsetLeft-tr.el.offsetLeft;
        const dy=targetTower.el.offsetTop-tr.el.offsetTop;
        const len=Math.sqrt(dx*dx+dy*dy);
        const speed=2;
        tr.el.style.left=(tr.el.offsetLeft+dx/len*speed)+'px';
        tr.el.style.top=(tr.el.offsetTop+dy/len*speed)+'px';
        if(len<25){ // Attack
          targetTower.hp-=tr.damage;
          if(targetTower.hp<=0){
            targetTower.el.remove();
            towers.splice(towers.indexOf(targetTower),1);
          }
        }
      }
    });
  }

  function checkVictory(){
    if(!towers.find(t=>t.type==='king' && t.owner==='ai')) endGame("Victory!","You destroyed enemy King!");
    if(!towers.find(t=>t.type==='king' && t.owner==='player')) endGame("Defeat!","Your King Tower was destroyed.");
  }

  function endGame(title,text){
    gameContainer.classList.add('hidden');
    messageTitle.textContent=title;
    messageText.textContent=text;
    messageModal.classList.remove('hidden');
    clearInterval(timerInterval);
    troops.forEach(t=>t.el.remove());
    troops=[];
    towers.forEach(t=>t.el.remove());
    towers.length=0;
  }

  restartButton.addEventListener('click',()=>{
    messageModal.classList.add('hidden');
    titleScreen.classList.remove('hidden');
  });
});
</script>

</body>
</html>
